<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Users</title>
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/bootstrap-icons/font/bootstrap-icons.css">
</head>
<body class="bg-light">

<div class="d-flex">
  <%- include('partials/admin-sidebar') %>

  <div class="container-fluid p-4">
    <h1>Manage Users</h1>
    <hr>

    <a href="/admin/users/add" class="btn btn-success mb-3">
      <i class="bi bi-person-plus"></i> Add New User
    </a>
    <a href="/admin/users/reset-password/<%= user.id %>" class="btn btn-sm btn-secondary">
      ğŸ” Reset My Password
    </a>

    <div class="table-responsive mt-3">
      <table class="table table-bordered table-hover bg-white shadow-sm">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Balance</th>
            <th>Level</th>
            <th>Total Spent</th>
            <th>Discount %</th>
            <th>Role</th>
            <th>Phone</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        <% users.forEach(u => { %>
          <tr>
            <td><%= u.id %></td>
            <td><%= u.username %></td>
            <td><%= u.email %></td>
            <td>$<%= Number(u.balance || 0).toFixed(2) %></td>

            <!-- ğŸŸ¡ Level / Loyalty Data -->
            <td><%= u.level || 1 %></td>
            <td>$<%= Number(u.total_spent || 0).toFixed(2) %></td>
            <td><%= Number(u.discount_percent || 0).toFixed(0) %>%</td>

            <td><%= u.role %></td>
            <td><%= u.phone || '-' %></td>
            <td><%= u.created_at %></td>

            <td>
              <a href="/admin/users/edit/<%= u.id %>" class="btn btn-warning btn-sm">
                âœ Edit
              </a>

              <form action="/admin/users/delete/<%= u.id %>"
                    method="POST"
                    onsubmit="return confirm('Are you sure you want to delete this user?');"
                    style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm">
                  <i class="bi bi-trash"></i> Delete
                </button>
              </form>

              <a href="/admin/users/reset-password/<%= u.id %>"
                 class="btn btn-secondary btn-sm">
                ğŸ”’ Reset
              </a>
            </td>
          </tr>
        <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

</body>
</html>
