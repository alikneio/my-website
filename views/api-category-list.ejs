<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= category.label %> - AK Cell</title>
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="stylesheet" href="/css/bootstrap-icons/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .out-card { position: relative; }
    .out-card .overlay {
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(220,53,69,.6); color:#fff; font-weight:700; letter-spacing:.5px;
      border-radius:1rem;
    }
    .out-card a.disabled-link { pointer-events:none; filter: grayscale(30%); opacity:.9; }
  </style>
</head>
<body>
  <%- include('partials/header') %>

  <div class="container my-5">
    <h1 class="text-center mb-4"><%= category.label %></h1>

    <div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
      <% if (products && products.length) { %>
        <% products.forEach(p => { 
             const href = user ? `/api-checkout/${p.id}` : '/login';
             const disabled = p.is_out_of_stock ? 'disabled-link' : '';
        %>
          <div class="col">
            <div class="card shadow-sm h-100 border-0 rounded-4 overflow-hidden text-center out-card">
              <a href="<%= href %>" class="d-block <%= disabled %>">
                <div class="p-3">
                  <img src="<%= category.image %>" onerror="this.src='/images/default-category.png'" alt="<%= category.label %>">

                </div>
                <div class="card-body">
                  <h6 class="fw-semibold text-dark mb-1"><%= p.name %></h6>
                  <% if (p.variable_quantity) { %>
                    <div class="text-primary fw-bold">Variable price</div>
                  <% } else { %>
                    <div class="text-primary fw-bold">$<%= Number(p.price).toFixed(2) %></div>
                  <% } %>
                </div>
              </a>

              <% if (p.is_out_of_stock) { %>
                <div class="overlay">OUT OF STOCK</div>
              <% } %>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="col-12 text-center text-muted py-5">
          No products in this category.
        </div>
      <% } %>
    </div>
  </div>

  <%- include('partials/footer') %>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
