<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title><%= category.label %> Products - AK Cell</title>
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="stylesheet" href="/css/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    .page-header{
      display:flex; align-items:center; gap:.75rem; margin:2rem 0 1.25rem;
    }
    .page-header img{ width:32px; height:32px; object-fit:contain }
    .category-title{ margin:0; font-weight:700; }

    .product-card{ transition:transform .2s ease, box-shadow .2s ease; border-radius:1rem; }
    .product-card:hover{ transform:translateY(-3px); box-shadow:0 8px 24px rgba(0,0,0,.08); }

    .product-image-wrap{ position:relative; }
    .product-img{ max-height:160px; object-fit:contain; }

    .oos {
      position:absolute; inset:0; border-radius:1rem;
      background:rgba(220,53,69,.28);
      display:flex; align-items:center; justify-content:center;
      font-weight:800; letter-spacing:.5px; color:#dc3545; text-shadow:0 1px 2px #fff;
    }

    .product-title{ min-height:2.25rem; line-height:1.25; transition:color .15s ease; }
    .category-card:hover .product-title { color:#0d6efd; }

    .price{ font-weight:700; color:#0d6efd; }

    /* زر معطل عند نفاد المخزون */
    .btn.disabled, .btn:disabled{ pointer-events:none; opacity:.7; }
  </style>
</head>
<body>
  <%- include('partials/header') %>

  <div class="container">
    <div class="page-header">
      <% if (category.image_url) { %>
        <img src="<%= category.image_url %>" alt="<%= category.label %>">
      <% } %>
      <h3 class="category-title"><%= category.label %> Products</h3>
    </div>

    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
      <% if (products && products.length) { %>
        <% products.forEach(p => { %>
          <div class="col">
            <div class="category-card h-100">
              <div class="card product-card h-100 border-0 shadow-sm text-center">
                <div class="product-image-wrap p-3">
                  <img class="card-img-top product-img" src="<%= p.image %>" alt="<%= p.name %>">
                  <% if (p.is_out_of_stock) { %><div class="oos">OUT OF STOCK</div><% } %>
                </div>

                <div class="card-body d-flex flex-column">
                  <h6 class="product-title mb-2"><%= p.name %></h6>

                  <% if (p.price !== null && p.price !== undefined) { %>
                    <div class="price mb-3">$<%= Number(p.price).toFixed(2) %></div>
                  <% } else { %>
                    <div class="text-muted small mb-3">
                      <%= p.unit_label ? `Variable (${p.unit_label})` : 'Variable quantity' %>
                    </div>
                  <% } %>

                  <a
                    href="/api-checkout/<%= p.id %>"
                    class="btn btn-primary mt-auto w-100 <%= p.is_out_of_stock ? 'disabled' : '' %>"
                    <%= p.is_out_of_stock ? 'aria-disabled="true" tabindex="-1"' : '' %>>
                    <%= p.requires_player_id ? 'Enter Details' : 'Buy Now' %>
                  </a>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="col-12"><p class="text-center text-muted fs-5">No products in this category yet.</p></div>
      <% } %>
    </div>
  </div>

  <%- include('partials/footer') %>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
