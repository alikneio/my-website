<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= category.label %> - AK Cell</title>
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="stylesheet" href="/css/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    .oos {
      position:absolute; inset:0; background:rgba(220, 53, 69, .5);
      display:flex; align-items:center; justify-content:center;
      color:#fff; font-weight:700; letter-spacing:.5px;
      border-radius: 1rem;
    }
    .card-wrap { position:relative; }
    .card-wrap.disabled { pointer-events:none; opacity:.7; }
  </style>
</head>
<body>
  <%- include('partials/header') %>

  <div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="mb-0"><%= category.label %></h1>
      <a class="btn btn-outline-secondary" href="/apps-section">
        <i class="bi bi-arrow-left"></i> Back
      </a>
    </div>

    <div class="row g-4">
      <% if (products.length === 0) { %>
        <div class="col-12 text-center text-muted">No products in this category.</div>
      <% } %>

      <% products.forEach(p => { %>
        <div class="col-6 col-md-4 col-lg-3">
          <div class="card-wrap <%= p.is_out_of_stock ? 'disabled' : '' %>">
            <a href="<%= p.is_out_of_stock ? '#' : ('/api-checkout/' + p.id) %>" class="text-decoration-none">
              <div class="card shadow-sm h-100 text-center border-0 rounded-4 overflow-hidden">
                <div class="p-3">
                  <img src="<%= p.image %>" class="img-fluid rounded-3"
                       alt="<%= p.name %>" onerror="this.src='/images/default-product.png'">
                </div>
                <div class="card-body">
                  <h6 class="mb-1 text-dark fw-semibold"><%= p.name %></h6>
                  <% if (p.variable_quantity) { %>
                    <div class="text-primary fw-bold">Variable</div>
                  <% } else { %>
                    <div class="text-primary fw-bold">$<%= Number(p.price).toFixed(2) %></div>
                  <% } %>
                </div>
              </div>
            </a>
            <% if (p.is_out_of_stock) { %>
              <div class="oos">OUT OF STOCK</div>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>
  </div>

  <%- include('partials/footer') %>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
