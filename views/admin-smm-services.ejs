<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin â€“ SMM Services</title>

  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="stylesheet" href="/css/bootstrap-icons/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
</head>

<body class="bg-light">

  <div class="d-flex" style="min-height:100vh;">

    <!-- Sidebar -->
    <%- include('partials/admin-sidebar') %>

    <!-- MAIN CONTENT -->
    <div class="flex-grow-1">

      <!-- Top Header -->
      <header class="bg-white border-bottom px-4 py-3 d-flex justify-content-between align-items-center">
        <h1 class="h4 m-0">
          <i class="bi bi-instagram"></i> Social Media Services
        </h1>

        <% if (user) { %>
        <div class="small text-muted">
          Logged in as <b><%= user.username || user.email %></b>
        </div>
        <% } %>
      </header>

      <!-- Page Content -->
      <main class="p-4">

        <% if (flash) { %>
          <div class="alert alert-<%= flash.type %>"><%= flash.msg %></div>
        <% } %>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h5 mb-0">SMM Services List</h2>

          <a href="/admin/smm/sync" class="btn btn-primary btn-sm">
            <i class="bi bi-arrow-repeat"></i> Sync from Provider
          </a>
        </div>

        <div class="card shadow-sm">
          <div class="card-body p-0">

            <div class="table-responsive">
              <table class="table table-hover mb-0 align-middle">
                <thead class="table-light">
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Rate / 1000</th>
                    <th>Min / Max</th>
                    <th>Status</th>
                    <th style="width:180px;">Actions</th>
                  </tr>
                </thead>

                <tbody>
                  <% if (!services || services.length === 0) { %>
                    <tr>
                      <td colspan="7" class="text-center text-muted py-4">
                        No services found. Click Sync to import from SMMGEN.
                      </td>
                    </tr>

                  <% } else { %>
                    <% services.forEach(s => { %>
                      <tr>
                        <td>#<%= s.id %></td>

                        <td>
                          <b><%= s.name %></b><br>
                          <small class="text-muted">
                            Provider ID: <%= s.provider_service_id %>
                          </small>
                        </td>

                        <td>
                          <span class="badge bg-secondary">
                            <%= s.category || 'Other' %>
                          </span>
                        </td>

                        <td>
                          $<%= Number(s.rate).toFixed(4) %>
                        </td>

                        <td>
                          <small>
                            Min: <b><%= s.min_qty %></b><br>
                            Max: <b><%= s.max_qty %></b>
                          </small>
                        </td>

                        <td>
                          <% if (s.is_active) { %>
                            <span class="badge bg-success">Active</span>
                          <% } else { %>
                            <span class="badge bg-secondary">Disabled</span>
                          <% } %>
                        </td>

                        <td>
                          <div class="d-flex gap-2">
                            <a
                              href="/admin/smm-services/<%= s.id %>/edit"
                              class="btn btn-sm btn-outline-primary"
                            >
                              <i class="bi bi-pencil-square"></i> Edit
                            </a>

                            <form
                              action="/admin/smm-services/<%= s.id %>/toggle"
                              method="POST"
                              onsubmit="return confirm('Are you sure?');"
                            >
                              <button
                                type="submit"
                                class="btn btn-sm <%= s.is_active ? 'btn-outline-warning' : 'btn-outline-success' %>">
                                <% if (s.is_active) { %>
                                  <i class="bi bi-eye-slash"></i> Disable
                                <% } else { %>
                                  <i class="bi bi-eye"></i> Enable
                                <% } %>
                              </button>
                            </form>
                          </div>
                        </td>
                      </tr>
                    <% }); %>
                  <% } %>

                </tbody>
              </table>
            </div>

          </div>
        </div>

      </main>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
